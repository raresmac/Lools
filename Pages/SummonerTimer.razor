@page "/summoner-timer"
@using System.Threading
@implements IDisposable
@inject IJSRuntime JS

<div class="min-h-screen bg-slate-950 p-2 md:p-6 text-white font-sans selection:bg-blue-500/30 relative overflow-x-hidden" @onclick="HandleGlobalClick">
    @if (Lanes == null || Spells == null || ChampionNames == null)
    {
        <div class="flex items-center justify-center h-screen">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
        </div>
    }
    else
    {
        @* --- 1. FLOATING HUD (TOP CENTERED - RESPONSIVE) --- *@
        <div class="fixed top-4 md:top-8 left-1/2 -translate-x-1/2 z-50 flex flex-col items-center pointer-events-none w-screen px-2">
            @if (!IsTeamLocked)
            {
                <button @onclick="ConfirmLock" @onclick:stopPropagation="true"
                        class="pointer-events-auto px-10 md:px-16 py-3 md:py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-black uppercase tracking-[0.2em] md:tracking-[0.3em] shadow-[0_0_50px_rgba(59,130,246,0.6)] transition-all hover:scale-105 active:scale-95 border-2 border-blue-400/30 text-xs md:text-sm">
                    🔒 Lock In Match
                </button>
            }
            else
            {
                @* Mobile: Stacks Buffs on top, Clock on bottom | Desktop: One long row *@
                <div class="pointer-events-auto bg-slate-900/95 backdrop-blur-2xl border border-slate-700/50 px-4 md:px-10 py-2 md:py-3 rounded-[2rem] md:rounded-full shadow-[0_30px_70px_rgba(0,0,0,0.8)] flex flex-col md:flex-row items-center justify-center gap-3 md:gap-10 min-w-[320px] md:min-w-0">

                    @* Buffs Row (Top on Mobile) *@
                    <div class="flex flex-row items-center gap-6 md:gap-10">
                        @* Blue Buff *@
                        <div class="flex items-center gap-2 md:gap-4">
                            <span class="text-[8px] md:text-[10px] font-black text-blue-500 uppercase tracking-widest text-center leading-tight">Blue<br />Buff</span>
                            <button @onclick="() => StartBuffTimer(true)" @onclick:stopPropagation="true" disabled="@(BlueBuffRemaining > 0)"
                                    class="w-16 md:w-24 h-9 md:h-10 rounded-xl border-2 flex items-center justify-center transition-all @(BlueBuffRemaining > 0 ? "border-slate-800 bg-slate-950 text-slate-500" : "border-blue-500/40 bg-blue-500/5 hover:border-blue-400 text-blue-100")">
                                @if (BlueBuffRemaining > 0)
                                {
                                    <span class="text-sm md:text-xl font-mono font-black">@FormatTime(BlueBuffRemaining)</span>
                                }
                                else
                                {

                                    <div class="w-4 h-4 bg-blue-500 rounded-full blur-sm animate-pulse"></div>
                                }
                            </button>
                        </div>

                        @* Red Buff *@
                        <div class="flex items-center gap-2 md:gap-4">
                            <button @onclick="() => StartBuffTimer(false)" @onclick:stopPropagation="true" disabled="@(RedBuffRemaining > 0)"
                                    class="w-16 md:w-24 h-9 md:h-10 rounded-xl border-2 flex items-center justify-center transition-all @(RedBuffRemaining > 0 ? "border-slate-800 bg-slate-950 text-slate-500" : "border-red-500/40 bg-red-500/5 hover:border-red-400 text-red-100")">
                                @if (RedBuffRemaining > 0)
                                {
                                    <span class="text-sm md:text-xl font-mono font-black">@FormatTime(RedBuffRemaining)</span>
                                }
                                else
                                {

                                    <div class="w-4 h-4 bg-red-500 rounded-full blur-sm animate-pulse"></div>
                                }
                            </button>
                            <span class="text-[8px] md:text-[10px] font-black text-red-500 uppercase tracking-widest text-center leading-tight">Red<br />Buff</span>
                        </div>
                    </div>

                    @* Clock & Reset Console (Bottom on Mobile) *@
                    <div class="flex items-center gap-4 md:gap-8 md:border-x border-slate-800/50 px-2 md:px-10">
                        <button @onclick="RequestReset" @onclick:stopPropagation="true"
                                class="text-[8px] md:text-[9px] font-black uppercase transition-all px-3 md:px-5 py-1.5 md:py-2.5 rounded-full border @(ShowResetConfirm ? "text-white bg-red-600 border-red-400 animate-pulse shadow-[0_0_15px_#ef4444]" : "text-slate-500 border-slate-800 hover:text-red-400")">
                            @(ShowResetConfirm ? "CONFIRM?" : "RESET")
                        </button>
                        <div class="flex items-center gap-4 md:gap-6 bg-slate-950/80 px-4 md:px-8 py-1 md:py-2 rounded-xl md:rounded-2xl border border-blue-500/20 shadow-inner">
                            <button @onclick="() => MatchSeconds = Math.Max(0, MatchSeconds - 1)" @onclick:stopPropagation="true" class="text-2xl md:text-3xl text-blue-500/50 hover:text-blue-400">-</button>
                            <span class="text-3xl md:text-5xl font-mono font-black text-blue-50 text-shadow-glow min-w-[90px] md:min-w-[150px] text-center">@FormatTime(MatchSeconds)</span>
                            <button @onclick="() => MatchSeconds++" @onclick:stopPropagation="true" class="text-2xl md:text-3xl text-blue-500/50 hover:text-blue-400">+</button>
                        </div>
                    </div>

                </div>
            }
        </div>

        @* --- 2. CHAMPION GRID --- *@
        <div class="max-w-[1700px] mx-auto pt-44 md:pt-32 px-4 md:px-16 transition-all duration-300" id="tracker-container">
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6">
                @foreach (var lane in Lanes)
                {
                    <div class="bg-slate-900 w-full rounded-3xl overflow-hidden border border-slate-800 shadow-2xl flex flex-col transform transition-all duration-500 @(IsTeamLocked ? "border-slate-700" : "hover:border-blue-500/30")">

                        @* Champion Portrait *@
                        <div class="relative transition-all duration-500 bg-slate-800 overflow-hidden border-b border-slate-700 @(IsTeamLocked ? "h-64 md:h-96" : "h-40 md:h-48")">
                            @{
                                var imgUrl = GetChampionImgUrl(lane.Champion);
                            }
                            @if (!string.IsNullOrWhiteSpace(imgUrl))
                            {
                                <img src="@imgUrl" class="w-full h-full object-cover object-top opacity-60" alt="" />
                            }
                            <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/10 to-transparent"></div>
                            <div class="absolute bottom-4 left-0 right-0 text-center px-2">
                                <span class="text-[10px] font-black text-blue-400 uppercase tracking-[0.4em] drop-shadow-lg">@lane.Name</span>
                                @if (IsTeamLocked && !string.IsNullOrWhiteSpace(lane.Champion))
                                {
                                    <div class="text-xl md:text-2xl font-black text-white mt-1 uppercase tracking-tighter italic truncate">@lane.Champion</div>
                                }
                            </div>
                        </div>

                        <div class="p-4 md:p-5 space-y-4 flex-grow">
                            @if (!IsTeamLocked)
                            {
                                <input type="text" list="champion-list" placeholder="Search..."
                                       @bind="lane.Champion" @bind:event="oninput"
                                       class="w-full bg-slate-950 border border-slate-800 text-white px-3 py-2 rounded-xl text-sm outline-none focus:ring-1 focus:ring-blue-500" />
                            }

                            @* HASTE TOGGLES *@
                            <div class="grid grid-cols-2 gap-2">
                                <button @onclick="() => lane.HasCosmicInsight = !lane.HasCosmicInsight" @onclick:stopPropagation="true"
                                        class="py-1.5 rounded-lg border font-bold text-[10px] md:text-xs uppercase transition-all @(lane.HasCosmicInsight ? "bg-teal-600 border-teal-400 text-white shadow-[0_0_10px_#14b8a6]" : "bg-slate-950 border-slate-800 text-slate-500")">
                                    Cosmic
                                </button>
                                <button @onclick="() => lane.HasIonianBoots = !lane.HasIonianBoots" @onclick:stopPropagation="true"
                                        class="py-1.5 rounded-lg border font-bold text-[10px] md:text-xs uppercase transition-all @(lane.HasIonianBoots ? "bg-blue-600 border-blue-400 text-white shadow-[0_0_10px_#3b82f6]" : "bg-slate-950 border-slate-800 text-slate-500")">
                                    Boots
                                </button>
                            </div>

                            @* ULTIMATE LOG *@
                            <div class="flex items-center gap-2">
                                <button @onclick="() => lane.UltLastUsed = MatchSeconds" @onclick:stopPropagation="true"
                                        class="flex-none px-3 py-1.5 rounded-lg border border-purple-500/40 bg-purple-500/10 text-purple-300 font-black text-[10px] md:text-xs uppercase tracking-widest hover:bg-purple-500/20 transition-all">
                                    ULT
                                </button>
                                <div class="flex-grow flex items-center justify-center bg-slate-950 border border-slate-800 rounded-xl p-1 h-9 md:h-10 shadow-inner">
                                    @if (lane.UltLastUsed.HasValue)
                                    {
                                        <button @onclick="() => lane.UltLastUsed = Math.Max(0, lane.UltLastUsed.Value - 1)" @onclick:stopPropagation="true" class="text-purple-500 hover:text-white font-bold text-lg px-2">-</button>
                                        <span class="text-sm md:text-lg font-mono font-bold text-purple-200">@FormatTime(lane.UltLastUsed)</span>
                                        <button @onclick="() => lane.UltLastUsed++" @onclick:stopPropagation="true" class="text-purple-500 hover:text-white font-bold text-lg px-2">+</button>
                                    }
                                    else
                                    {

                                        <span class="text-[9px] md:text-xs text-slate-700 uppercase font-black tracking-widest">Logged</span>
                                    }
                                </div>
                            </div>

                            @* SUMMONER SPELLS (Icons Fixed) *@
                            <div class="grid grid-cols-1 gap-3">
                                @* Slot 1 *@
                                <div class="space-y-1">
                                    @if (!IsTeamLocked)
                                    {
                                        <select @bind="lane.SelectedSpell1Key" @onclick:stopPropagation="true"
                                                class="w-full bg-slate-800 text-white text-[10px] px-2 py-1.5 rounded-lg border border-slate-700 uppercase font-bold outline-none">
                                            @foreach (var s in Spells.Where(kv => kv.Key != lane.SelectedSpell2Key))
                                            {
                                                <option value="@s.Key">@s.Value.Name</option>
                                            }
                                        </select>
                                    }
                                    @if (Spells.TryGetValue(lane.SelectedSpell1Key, out var s1))
                                    {
                                        <div class="relative h-16 md:h-20">
                                            @if (lane.Spell1Remaining.HasValue)
                                            {
                                                <button @onclick="() => lane.Spell1Remaining = null" @onclick:stopPropagation="true" class="absolute -top-2 -left-2 z-40 bg-red-600 rounded-full p-1 shadow-xl">
                                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" /></svg>
                                                </button>
                                            }
                                            <button @onclick="() => StartTimer(lane, true)" @onclick:stopPropagation="true" disabled="@(lane.Spell1Remaining.HasValue)"
                                                    class="w-full h-full relative overflow-hidden rounded-2xl border-2 transition-all @(lane.Spell1Remaining.HasValue ? "border-slate-800 bg-slate-900" : "border-yellow-500/20 hover:border-yellow-400 bg-slate-900/40 group")">
                                                <img src="@s1.IconUrl" class="absolute inset-0 w-full h-full object-cover opacity-20 group-hover:opacity-40" />
                                                <div class="relative z-10 flex flex-col items-center justify-center h-full">
                                                    @if (lane.Spell1Remaining.HasValue)
                                                    {
                                                        <span class="text-3xl md:text-4xl font-black italic tracking-tighter">@FormatTime(lane.Spell1Remaining)</span>
                                                        <span class="text-[8px] md:text-[9px] font-bold text-yellow-500/70 uppercase">@@ @FormatTime(lane.Spell1ReadyAt)</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-[10px] font-black text-yellow-500 uppercase tracking-widest">@s1.Name</span>
                                                        <span class="text-base md:text-lg font-mono font-bold text-white">@FormatTime(CalculateCd(s1.BaseCd, lane.TotalHaste))</span>
                                                    }
                                                </div>
                                            </button>
                                        </div>
                                    }
                                </div>

                                @* Slot 2 *@
                                <div class="space-y-1">
                                    @if (!IsTeamLocked)
                                    {
                                        <select @bind="lane.SelectedSpell2Key" @onclick:stopPropagation="true" disabled="@(lane.Name == "Jungle")"
                                                class="w-full bg-slate-800 text-white text-[10px] px-2 py-1.5 rounded-lg border border-slate-700 uppercase font-bold outline-none">
                                            @foreach (var s in Spells.Where(kv => kv.Key != lane.SelectedSpell1Key))
                                            {
                                                <option value="@s.Key">@s.Value.Name</option>
                                            }
                                        </select>
                                    }
                                    @if (Spells.TryGetValue(lane.SelectedSpell2Key, out var s2))
                                    {
                                        <div class="relative h-16 md:h-20">
                                            @if (lane.Spell2Remaining.HasValue)
                                            {
                                                <button @onclick="() => lane.Spell2Remaining = null" @onclick:stopPropagation="true" class="absolute -top-2 -left-2 z-40 bg-red-600 rounded-full p-1 shadow-xl">
                                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" /></svg>
                                                </button>
                                            }
                                            <button @onclick="() => StartTimer(lane, false)" @onclick:stopPropagation="true" disabled="@(lane.Spell2Remaining.HasValue)"
                                                    class="w-full h-full relative overflow-hidden rounded-2xl border-2 transition-all @(lane.Spell2Remaining.HasValue ? "border-slate-800 bg-slate-900" : "border-blue-500/20 hover:border-blue-400 bg-slate-900/40 group")">
                                                <img src="@s2.IconUrl" class="absolute inset-0 w-full h-full object-cover opacity-20 group-hover:opacity-40" />
                                                <div class="relative z-10 flex flex-col items-center justify-center h-full">
                                                    @if (lane.Spell2Remaining.HasValue)
                                                    {
                                                        <span class="text-3xl md:text-4xl font-black italic tracking-tighter">@FormatTime(lane.Spell2Remaining)</span>
                                                        <span class="text-[8px] md:text-[9px] font-bold text-blue-400/70 uppercase">@@ @FormatTime(lane.Spell2ReadyAt)</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-[10px] font-black text-blue-400 uppercase tracking-widest">@s2.Name</span>
                                                        <span class="text-base md:text-lg font-mono font-bold text-white">@FormatTime(CalculateCd(s2.BaseCd, lane.TotalHaste))</span>
                                                    }
                                                </div>
                                            </button>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
        <datalist id="champion-list">@foreach (var n in ChampionNames) {
        <option value="@n" />
    }
</datalist>
        }
</div>

<style>
    .text-shadow-glow {
        text-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
    }

    /* Responsive Sidebar Fix */
    body.sidebar-collapsed aside {
        width: 5rem !important;
        transition: width 0.3s ease;
    }

    body.sidebar-collapsed .sidebar-text {
        display: none !important;
    }

    @@media (max-width: 768px) {
        /* Prevent NavMenu from overlapping floating HUD on mobile when sidebar is open */
        .sidebar {
            z-index: 60 !important;
        }
    }
</style>

@code {
    public class Spell { public string Name { get; set; } = ""; public int BaseCd { get; set; } public string IconUrl { get; set; } = ""; }
    public class LaneState
    {
        public string Name { get; set; } = "";
        public string Champion { get; set; } = "";
        public string SelectedSpell1Key { get; set; } = "flash";
        public string SelectedSpell2Key { get; set; } = "";
        public bool HasCosmicInsight { get; set; } = false;
        public bool HasIonianBoots { get; set; } = false;
        public int TotalHaste => (HasCosmicInsight ? 18 : 0) + (HasIonianBoots ? 12 : 0);
        public int? Spell1Remaining { get; set; }
        public int? Spell1ReadyAt { get; set; }
        public int? Spell2Remaining { get; set; }
        public int? Spell2ReadyAt { get; set; }
        public int? UltLastUsed { get; set; }
    }

    private bool IsTeamLocked = false;
    private bool ShowResetConfirm = false;
    private int MatchSeconds = 0;
    private int? BlueBuffRemaining;
    private int? RedBuffRemaining;
    private CancellationTokenSource _cts = new();
    private CancellationTokenSource? _confirmCts;
    private List<LaneState> Lanes = new() { new LaneState { Name = "Top" }, new LaneState { Name = "Jungle", SelectedSpell2Key = "smite" }, new LaneState { Name = "Mid" }, new LaneState { Name = "Bot" }, new LaneState { Name = "Support" } };
    private Dictionary<string, Spell> Spells = new();
    private List<string> ChampionNames = new() { "Aatrox", "Ahri", "Akali", "Akshan", "Alistar", "Ambessa", "Amumu", "Anivia", "Annie", "Aphelios", "Ashe", "Aurelion Sol", "Aurora", "Azir", "Bard", "Bel'Veth", "Blitzcrank", "Brand", "Braum", "Briar", "Caitlyn", "Camille", "Cassiopeia", "Cho'Gath", "Corki", "Darius", "Diana", "Dr. Mundo", "Draven", "Ekko", "Elise", "Evelynn", "Ezreal", "Fiddlesticks", "Fiora", "Fizz", "Galio", "Gangplank", "Garen", "Gnar", "Gragas", "Graves", "Gwen", "Hecarim", "Heimerdinger", "Hwei", "Illaoi", "Irelia", "Ivern", "Janna", "Jarvan IV", "Jax", "Jayce", "Jhin", "Jinx", "K'Sante", "Kai'Sa", "Kalista", "Karma", "Karthus", "Kassadin", "Katarina", "Kayle", "Kayn", "Kennen", "Kha'Zix", "Kindred", "Kled", "Kog'Maw", "LeBlanc", "Lee Sin", "Leona", "Lillia", "Lissandra", "Lucian", "Lulu", "Lux", "Malphite", "Malzahar", "Maokai", "Master Yi", "Mel", "Milio", "Miss Fortune", "Mordekaiser", "Morgana", "Naafiri", "Nami", "Nasus", "Nautilus", "Neeko", "Nidalee", "Nilah", "Nocturne", "Nunu & Willump", "Olaf", "Orianna", "Ornn", "Pantheon", "Poppy", "Pyke", "Qiyana", "Quinn", "Rakan", "Rammus", "Rek'Sai", "Rell", "Renata Glasc", "Renekton", "Rengar", "Riven", "Rumble", "Ryze", "Samira", "Sejuani", "Senna", "Seraphine", "Sett", "Shaco", "Shen", "Shyvana", "Singed", "Sion", "Sivir", "Skarner", "Smolder", "Sona", "Soraka", "Swain", "Sylas", "Syndra", "Tahm Kench", "Taliyah", "Talon", "Taric", "Teemo", "Thresh", "Tristana", "Trundle", "Tryndamere", "Twisted Fate", "Twitch", "Udyr", "Urgot", "Varus", "Vayne", "Veigar", "Vel'Koz", "Vex", "Vi", "Viego", "Viktor", "Vladimir", "Volibear", "Warwick", "Wukong", "Xayah", "Xerath", "Xin Zhao", "Yasuo", "Yone", "Yorick", "Yuumi", "Zac", "Zed", "Zeri", "Ziggs", "Zilean", "Zoe", "Zyra" };

    protected override void OnInitialized()
    {
        string GetIcon(string n) => $"https://ddragon.leagueoflegends.com/cdn/14.1.1/img/spell/Summoner{n}.png";
        Spells = new Dictionary<string, Spell> { { "flash", new Spell { Name = "Flash", BaseCd = 300, IconUrl = GetIcon("Flash") } }, { "teleport", new Spell { Name = "Teleport", BaseCd = 360, IconUrl = GetIcon("Teleport") } }, { "ignite", new Spell { Name = "Ignite", BaseCd = 180, IconUrl = GetIcon("Dot") } }, { "heal", new Spell { Name = "Heal", BaseCd = 240, IconUrl = GetIcon("Heal") } }, { "exhaust", new Spell { Name = "Exhaust", BaseCd = 210, IconUrl = GetIcon("Exhaust") } }, { "ghost", new Spell { Name = "Ghost", BaseCd = 210, IconUrl = GetIcon("Haste") } }, { "smite", new Spell { Name = "Smite", BaseCd = 90, IconUrl = GetIcon("Smite") } }, { "barrier", new Spell { Name = "Barrier", BaseCd = 180, IconUrl = GetIcon("Barrier") } }, { "cleanse", new Spell { Name = "Cleanse", BaseCd = 210, IconUrl = GetIcon("Boost") } } };
        _ = RunTimer();
    }

    private void StartBuffTimer(bool isBlue) { if (isBlue) BlueBuffRemaining = 300; else RedBuffRemaining = 300; }
    private async Task RequestReset()
    {
        if (!ShowResetConfirm) { ShowResetConfirm = true; _confirmCts?.Cancel(); _confirmCts = new CancellationTokenSource(); try { await Task.Delay(3000, _confirmCts.Token); ShowResetConfirm = false; StateHasChanged(); } catch { } }
        else { _confirmCts?.Cancel(); IsTeamLocked = false; ShowResetConfirm = false; MatchSeconds = 0; BlueBuffRemaining = null; RedBuffRemaining = null; foreach (var l in Lanes) { l.Spell1Remaining = null; l.Spell2Remaining = null; l.UltLastUsed = null; } StateHasChanged(); }
    }
    private void HandleGlobalClick() { if (ShowResetConfirm) { _confirmCts?.Cancel(); ShowResetConfirm = false; } }
    private async Task ConfirmLock() { if (Lanes.Any(l => string.IsNullOrEmpty(l.SelectedSpell1Key) || string.IsNullOrEmpty(l.SelectedSpell2Key))) { await JS.InvokeVoidAsync("alert", "Select spells."); return; } IsTeamLocked = true; }
    private void StartTimer(LaneState lane, bool isSpell1)
    {
        string key = isSpell1 ? lane.SelectedSpell1Key : lane.SelectedSpell2Key;
        if (Spells.TryGetValue(key, out var s))
        {
            int cd = CalculateCd(s.BaseCd, lane.TotalHaste);
            int rem = Math.Max(0, cd - 1);
            if (isSpell1) { lane.Spell1Remaining = rem; lane.Spell1ReadyAt = MatchSeconds + rem; } else { lane.Spell2Remaining = rem; lane.Spell2ReadyAt = MatchSeconds + rem; }
        }
    }
    private async Task RunTimer()
    {
        try { using var timer = new PeriodicTimer(TimeSpan.FromSeconds(1)); while (await timer.WaitForNextTickAsync(_cts.Token)) { if (IsTeamLocked) { MatchSeconds++; if (BlueBuffRemaining > 0) BlueBuffRemaining--; else BlueBuffRemaining = null; if (RedBuffRemaining > 0) RedBuffRemaining--; else RedBuffRemaining = null; } foreach (var l in Lanes) { if (l.Spell1Remaining > 0) l.Spell1Remaining--; else l.Spell1Remaining = null; if (l.Spell2Remaining > 0) l.Spell2Remaining--; else l.Spell2Remaining = null; } await InvokeAsync(StateHasChanged); } }
        catch (OperationCanceledException) { }
    }
    private int CalculateCd(int b, int h) => (int)Math.Round(b / (1.0 + (h / 100.0)));
    private string FormatTime(int? s) => !s.HasValue ? "READY" : $"{(s.Value / 60)}:{(s.Value % 60):D2}";
    private string GetChampionImgUrl(string n)
    {
        if (string.IsNullOrWhiteSpace(n)) return "";
        string i = n.Replace("'", "").Replace(" ", "").Replace(".", "").Replace("-", "").ToLower().Trim();
        var s = new Dictionary<string, string> { { "wukong", "MonkeyKing" }, { "jarvaniv", "JarvanIV" }, { "jarvan4", "JarvanIV" }, { "jarvan", "JarvanIV" }, { "drmundo", "DrMundo" }, { "ksante", "Ksante" }, { "leblanc", "Leblanc" } };
        if (s.TryGetValue(i, out var m)) return $"https://ddragon.leagueoflegends.com/cdn/img/champion/loading/{m}_0.jpg";
        return $"https://ddragon.leagueoflegends.com/cdn/img/champion/loading/{char.ToUpper(i[0]) + i.Substring(1)}_0.jpg";
    }
    public void Dispose() { _cts.Cancel(); _cts.Dispose(); _confirmCts?.Cancel(); _confirmCts?.Dispose(); }
}